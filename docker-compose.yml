services:
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: ["redis-server", "--appendonly", "no"]

  web:
    build: .
    ports:
      - "8000:8000"
    environment:
      # Point the app at the compose Redis service (NOT localhost inside container)
      REDIS_URL: redis://redis:6379/0
      # Local/dev defaults (override as needed)
      DJANGO_DEBUG: "1"
      DJANGO_ALLOWED_HOSTS: "localhost,127.0.0.1,192.168.5.165"
      INSTANCE_ID: "docker-local"
      # You can also put this in an env_file; keeping it explicit avoids confusion
      DJANGO_SECRET_KEY: "local-dev-change-me"
      # LLM service URL: use service name "llm" (container-to-container), port 7980 is internal
      LLM_SERVICE_URL: "http://llm:7980"
    depends_on:
      - redis
      - llm

  llm:
    build:
      context: ./llm
      dockerfile: Dockerfile
    ports:
      - "7980:7980"
    environment:
      # WebSocket server URL: use service name "web" so LLM container can reach ws_server
      WS_SERVER_URL: "ws://web:8000"
      # Optional: set via env_file for Postgres, AWS, AUTH_API_KEY, etc.
    env_file:
      - .env

